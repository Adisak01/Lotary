<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMORPG Prototype</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { text-align: center; background-color: #f4f4f4; }
        canvas { background: #ddd; display: block; margin: auto; }
        #controller { margin-top: 20px; }
        .btn-control { width: 60px; height: 60px; font-size: 18px; }
        #attackButton { margin-top: 10px; }
    </style>
</head>
<body>
    <h1 class="mt-3">MMORPG Prototype</h1>
    <p>ใช้ปุ่มควบคุมด้านล่างเพื่อเคลื่อนที่ | กดปุ่มโจมตีเพื่อตีมอนสเตอร์</p>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    
    <div id="controller" class="d-flex justify-content-center">
        <div>
            <button class="btn btn-primary btn-control" id="upBtn">↑</button><br>
            <button class="btn btn-primary btn-control" id="leftBtn">←</button>
            <button class="btn btn-primary btn-control" id="downBtn">↓</button><br>
            <button class="btn btn-primary btn-control" id="rightBtn">→</button>
        </div>
        <div>
            <button class="btn btn-danger btn-control" id="attackButton">Attack</button>
        </div>
    </div>

    <p id="status"></p>
    <p id="inventory"></p>

    <script>
        // ดึง Canvas มาใช้
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // ตัวละครผู้เล่น
        const player = {
            x: 50, y: 50, size: 30, speed: 5,
            exp: 0, level: 1, expNeeded: 10, statPoints: 0,
            attack: 5, inventory: [], skills: []
        };

        // มอนสเตอร์
        let monsters = [];
        function spawnMonster() {
            return { x: Math.random() * 750, y: Math.random() * 450, size: 30, hp: 20, expReward: 5 };
        }
        for (let i = 0; i < 3; i++) monsters.push(spawnMonster());

        // เควสต์
        let quest = { target: 5, progress: 0, completed: false };

        // การควบคุมการเคลื่อนที่
        let moveLeft = false, moveRight = false, moveUp = false, moveDown = false;
        
        document.getElementById("upBtn").addEventListener("click", () => moveUp = true);
        document.getElementById("downBtn").addEventListener("click", () => moveDown = true);
        document.getElementById("leftBtn").addEventListener("click", () => moveLeft = true);
        document.getElementById("rightBtn").addEventListener("click", () => moveRight = true);

        // โจมตีมอนสเตอร์
        function attackMonster() {
            for (let i = 0; i < monsters.length; i++) {
                let m = monsters[i];
                if (Math.abs(player.x - m.x) < 30 && Math.abs(player.y - m.y) < 30) {
                    m.hp -= player.attack;
                    if (m.hp <= 0) {
                        player.exp += m.expReward;
                        quest.progress += 1;
                        if (quest.progress >= quest.target) quest.completed = true;
                        dropItem();
                        monsters[i] = spawnMonster(); // สร้างมอนใหม่
                        checkLevelUp();
                    }
                    return;
                }
            }
        }

        // สุ่มไอเทมหรือสกิลจากมอนสเตอร์
        function dropItem() {
            let items = ["Sword", "Shield", "Helmet", "Fireball Skill"];
            let drop = items[Math.floor(Math.random() * items.length)];
            if (drop === "Fireball Skill") {
                player.skills.push(drop);
            } else {
                player.inventory.push(drop);
            }
        }

        // อัปเลเวล
        function checkLevelUp() {
            if (player.exp >= player.expNeeded) {
                player.level++;
                player.exp -= player.expNeeded;
                player.expNeeded += 5;
                player.statPoints += 2;
            }
        }

        // อัปเดตสถานะเกม
        function updateGame() {
            if (moveLeft) player.x -= player.speed;
            if (moveRight) player.x += player.speed;
            if (moveUp) player.y -= player.speed;
            if (moveDown) player.y += player.speed;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // วาดตัวละคร
            ctx.fillStyle = "blue";
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // วาดมอนสเตอร์
            ctx.fillStyle = "red";
            for (let m of monsters) {
                ctx.fillRect(m.x, m.y, m.size, m.size);
            }

            // แสดงสถานะ
            document.getElementById("status").innerHTML = 
                `Level: ${player.level} | EXP: ${player.exp}/${player.expNeeded} | Stat Points: ${player.statPoints} | Quest: ${quest.progress}/${quest.target} ${quest.completed ? "✅" : ""}`;
            document.getElementById("inventory").innerHTML = 
                `Inventory: ${player.inventory.join(", ")} | Skills: ${player.skills.join(", ")}`;
        }

        // กดปุ่มโจมตี
        document.getElementById("attackButton").addEventListener("click", () => {
            attackMonster();
        });

        // เริ่มเกม
        function gameLoop() {
            updateGame();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
