<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบซื้อหวยออนไลน์</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .winner { color: green; font-weight: bold; }
        .loser { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">ระบบซื้อหวยออนไลน์</h2>

    <!-- ปุ่มเพิ่มผู้ซื้อ -->
    <button class="btn btn-primary mb-3" onclick="showBuyerModal()">เพิ่มผู้ซื้อ</button>

    <!-- รายการผู้ซื้อ -->
    <h4>รายการซื้อวันนี้</h4>
    <ul id="buyerList" class="list-group"></ul>

    <!-- ปุ่มตรวจรางวัล -->
    <h4 class="mt-4">ตรวจรางวัล</h4>
    <div class="input-group mb-3">
        <input type="text" id="prize3Digit" class="form-control" placeholder="เลข 3 ตัว">
        <input type="text" id="prize2Digit" class="form-control" placeholder="เลข 2 ตัว">
        <button class="btn btn-success" onclick="checkPrizes()">ตรวจสอบ</button>
    </div>

    <!-- Modal เพิ่มผู้ซื้อ -->
    <div class="modal fade" id="buyerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">เพิ่มผู้ซื้อ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="buyerName" class="form-control mb-2" placeholder="ชื่อผู้ซื้อ">
                    <button class="btn btn-success" onclick="addBuyer()">บันทึก</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal เพิ่มรายการหวย -->
    <div class="modal fade" id="lotteryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">เพิ่มรายการหวย</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="currentBuyerId">
                    <input type="text" id="lotteryNumber" class="form-control mb-2" placeholder="เลขที่ซื้อ">
                    <input type="number" id="lotteryAmount" class="form-control mb-2" placeholder="จำนวนเงิน">
                    <select id="lotteryType" class="form-control mb-2">
                        <option value="3">สามตัว</option>
                        <option value="2">สองตัว</option>
                    </select>
                    <button class="btn btn-success" onclick="addLottery()">บันทึก</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal รายการซื้อ -->
    <div class="modal fade" id="lotteryListModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">รายการที่ซื้อ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul id="lotteryList" class="list-group"></ul>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    let buyers = JSON.parse(localStorage.getItem("buyers")) || [];

    function showBuyerModal() {
        document.getElementById("buyerName").value = "";
        new bootstrap.Modal(document.getElementById("buyerModal")).show();
    }

    function addBuyer() {
        let name = document.getElementById("buyerName").value.trim();
        if (!name) return alert("กรุณากรอกชื่อ");

        let newBuyer = { id: Date.now(), name, lotteries: [] };
        buyers.push(newBuyer);
        saveData();
        renderBuyers();
        bootstrap.Modal.getInstance(document.getElementById("buyerModal")).hide();
    }

    function renderBuyers() {
        let list = document.getElementById("buyerList");
        list.innerHTML = "";
        buyers.forEach(buyer => {
            let li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
                ${buyer.name} (${buyer.lotteries.length} รายการ)
                <div>
                    <button class="btn btn-sm btn-primary" onclick="showLotteryModal(${buyer.id})"><i class="fas fa-plus"></i> เพิ่มหวย</button>
                    <button class="btn btn-sm btn-info" onclick="showLotteryList(${buyer.id})"><i class="fas fa-list"></i> รายการ</button>
                </div>
            `;
            list.appendChild(li);
        });
    }

    function showLotteryModal(buyerId) {
        document.getElementById("currentBuyerId").value = buyerId;
        document.getElementById("lotteryNumber").value = "";
        document.getElementById("lotteryAmount").value = "";
        new bootstrap.Modal(document.getElementById("lotteryModal")).show();
    }

    function addLottery() {
        let buyerId = document.getElementById("currentBuyerId").value;
        let number = document.getElementById("lotteryNumber").value.trim();
        let amount = parseFloat(document.getElementById("lotteryAmount").value);
        let type = document.getElementById("lotteryType").value;

        if (!number || isNaN(amount) || amount <= 0) return alert("กรุณากรอกข้อมูลให้ถูกต้อง");

        let buyer = buyers.find(b => b.id == buyerId);
        buyer.lotteries.push({ number, amount, type });
        saveData();
        renderBuyers();
        bootstrap.Modal.getInstance(document.getElementById("lotteryModal")).hide();
    }

    function showLotteryList(buyerId) {
        let buyer = buyers.find(b => b.id == buyerId);
        let list = document.getElementById("lotteryList");
        list.innerHTML = "";

        buyer.lotteries.forEach((lottery, index) => {
            let li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between";
            li.innerHTML = `
                ${lottery.number} (${lottery.type == "3" ? "สามตัว" : "สองตัว"}) - ${lottery.amount} บาท
                <button class="btn btn-sm btn-danger" onclick="deleteLottery(${buyerId}, ${index})"><i class="fas fa-trash"></i></button>
            `;
            list.appendChild(li);
        });

        new bootstrap.Modal(document.getElementById("lotteryListModal")).show();
    }

    function deleteLottery(buyerId, index) {
        let buyer = buyers.find(b => b.id == buyerId);
        buyer.lotteries.splice(index, 1);
        saveData();
        showLotteryList(buyerId);
    }

    function saveData() {
        localStorage.setItem("buyers", JSON.stringify(buyers));
    }

    window.onload = renderBuyers;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
