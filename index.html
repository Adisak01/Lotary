<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMORPG Prototype</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { text-align: center; background-color: #f4f4f4; }
        canvas { background: #ddd; display: block; margin: auto; }
    </style>
</head>
<body>
    <h1 class="mt-3">MMORPG Prototype</h1>
    <p>ใช้การสัมผัสเพื่อควบคุมตัวละคร | แตะที่หน้าจอเพื่อตีมอนสเตอร์</p>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <p id="status"></p>
    <p id="inventory"></p>
    
    <script>
        // ดึง Canvas มาใช้
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // ตัวละครผู้เล่น
        const player = {
            x: 50, y: 50, size: 30, speed: 5,
            exp: 0, level: 1, expNeeded: 10, statPoints: 0,
            attack: 5, inventory: [], skills: [],
            lastTouchX: 0, lastTouchY: 0
        };

        // มอนสเตอร์
        let monsters = [];
        function spawnMonster() {
            return { x: Math.random() * 750, y: Math.random() * 450, size: 30, hp: 20, expReward: 5 };
        }
        for (let i = 0; i < 3; i++) monsters.push(spawnMonster());

        // เควสต์
        let quest = { target: 5, progress: 0, completed: false };

        // การสัมผัสและเคลื่อนที่
        canvas.addEventListener("touchstart", (e) => {
            let touch = e.touches[0];
            player.lastTouchX = touch.pageX;
            player.lastTouchY = touch.pageY;
        });

        canvas.addEventListener("touchmove", (e) => {
            let touch = e.touches[0];
            let dx = touch.pageX - player.lastTouchX;
            let dy = touch.pageY - player.lastTouchY;
            player.x += dx * 0.1; // เคลื่อนที่ช้าลง
            player.y += dy * 0.1;
            player.lastTouchX = touch.pageX;
            player.lastTouchY = touch.pageY;
        });

        // โจมตีมอนสเตอร์
        function attackMonster() {
            for (let i = 0; i < monsters.length; i++) {
                let m = monsters[i];
                if (Math.abs(player.x - m.x) < 30 && Math.abs(player.y - m.y) < 30) {
                    m.hp -= player.attack;
                    if (m.hp <= 0) {
                        player.exp += m.expReward;
                        quest.progress += 1;
                        if (quest.progress >= quest.target) quest.completed = true;
                        dropItem();
                        monsters[i] = spawnMonster(); // สร้างมอนใหม่
                        checkLevelUp();
                    }
                    return;
                }
            }
        }

        // สุ่มไอเทมหรือสกิลจากมอนสเตอร์
        function dropItem() {
            let items = ["Sword", "Shield", "Helmet", "Fireball Skill"];
            let drop = items[Math.floor(Math.random() * items.length)];
            if (drop === "Fireball Skill") {
                player.skills.push(drop);
            } else {
                player.inventory.push(drop);
            }
        }

        // อัปเลเวล
        function checkLevelUp() {
            if (player.exp >= player.expNeeded) {
                player.level++;
                player.exp -= player.expNeeded;
                player.expNeeded += 5;
                player.statPoints += 2;
            }
        }

        // อัปเดตสถานะเกม
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // วาดตัวละคร
            ctx.fillStyle = "blue";
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // วาดมอนสเตอร์
            ctx.fillStyle = "red";
            for (let m of monsters) {
                ctx.fillRect(m.x, m.y, m.size, m.size);
            }

            // แสดงสถานะ
            document.getElementById("status").innerHTML = 
                `Level: ${player.level} | EXP: ${player.exp}/${player.expNeeded} | Stat Points: ${player.statPoints} | Quest: ${quest.progress}/${quest.target} ${quest.completed ? "✅" : ""}`;
            document.getElementById("inventory").innerHTML = 
                `Inventory: ${player.inventory.join(", ")} | Skills: ${player.skills.join(", ")}`;
        }

        // แตะที่หน้าจอเพื่อตีมอน
        canvas.addEventListener("touchstart", (e) => {
            attackMonster();
        });

        // เริ่มเกม
        function gameLoop() {
            updateGame();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
